<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.17.0.final using JasperReports Library version 6.17.0-6d93193241dd8cc42629e188b94f9e0bc5722efd  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ts_c6" pageWidth="50" pageHeight="23" orientation="Landscape" whenNoDataType="NoPages" columnWidth="50" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="36157d8a-524b-4e97-b122-3ab8854d554d">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="adempiere_7.1"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w1" value="0"/>
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w2" value="1000"/>
	<parameter name="StartDate" class="java.sql.Date">
		<defaultValueExpression><![CDATA[new Date(100,0,1)]]></defaultValueExpression>
	</parameter>
	<parameter name="EndDate" class="java.util.Date">
		<defaultValueExpression><![CDATA[new Date(100,0,1)]]></defaultValueExpression>
	</parameter>
	<parameter name="C_Activity_ID" class="java.lang.Integer"/>
	<parameter name="M_Lot_ID" class="java.lang.Integer"/>
	<parameter name="AD_Org_ID" class="java.lang.Integer"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String">
		<defaultValueExpression><![CDATA["dev/"]]></defaultValueExpression>
	</parameter>
	<parameter name="AD_CLIENT_ID" class="java.lang.Integer"/>
	<queryString>
		<![CDATA[select case when (sum(f.tong))<>0 then round( (sum(f.sum_a)/sum(f.tong))*100,0)  else 0 end as kq 
from(
-- tong C5--
        select  sum(k.c5) as tong, 0 as sum_a 
    from ( 
	SELECT k.lot, k.sl AS c5
	FROM (
		SELECT att.m_attributesetinstance_id, att.lot, civ.productionqty AS sl
		FROM m_productionplan civ
		JOIN m_production pro ON civ.m_production_id = pro.m_production_id AND pro.docstatus IN ('CO', 'CL')
		JOIN m_product hh ON hh.m_product_id = civ.m_product_id AND hh.M_Product_Category_ID = 1000085 AND  hh.M_Product_ID NOT IN (1013026)
		JOIN m_attributesetinstance att ON civ.m_attributesetinstance_id = att.m_attributesetinstance_id  AND att.M_AttributeSet_ID = 1000065 AND att.lot IS NOT NULL
		WHERE civ.ad_client_id = $P{AD_CLIENT_ID} 
		union all
		SELECT att.m_attributesetinstance_id, att.lot, (civ.productionqty * hh.shelfwidth * hh.shelfdepth * hh.shelfheight)/1000000000 AS sl
		FROM m_productionplan civ
		JOIN m_production pro ON civ.m_production_id = pro.m_production_id AND pro.docstatus IN ('CO', 'CL')
		JOIN m_product hh ON hh.m_product_id = civ.m_product_id AND  hh.M_Product_ID in (1017248,1017259)
		JOIN m_attributesetinstance att ON civ.m_attributesetinstance_id = att.m_attributesetinstance_id  AND att.M_AttributeSet_ID = 1000065 AND att.lot IS NOT NULL
		WHERE civ.ad_client_id = $P{AD_CLIENT_ID} 
		) AS k
	 JOIN m_lot lo ON lo.name = k.lot  AND lo.dateto >= $P{StartDate} AND lo.dateto <= $P{EndDate} AND (lo.M_Lot_ID = $P{M_Lot_ID} OR $P{M_Lot_ID} IS NULL) and (lo.AD_Org_ID=$P{AD_Org_ID} OR $P{AD_Org_ID} is null) 
	 where  lo.ad_client_id = $P{AD_CLIENT_ID} and(lo.ad_org_id = $P{AD_Org_ID} or $P{AD_Org_ID}  is null)
     ) as k
	
--Van A---

UNION ALL

    select 0 as tong, sum(k.c6) as sum_a 
    FROM (
        SELECT t.lot AS c1, 0 c2, 0 AS c3, 0 AS c4, 0 AS c5, sum(t.sl) AS c6, 0 AS c7, 0 AS c8, 0 AS c9, 0 AS c10
        FROM (
            SELECT tt.lot, civ.productionqty AS sl
            FROM m_productionplan civ
            JOIN m_production ci ON civ.m_production_id = ci.m_production_id AND ci.docstatus IN ('CO', 'CL') and (ci.C_Activity_ID = $P{C_Activity_ID}  OR $P{C_Activity_ID}  IS NULL)
            JOIN m_product hh ON civ.m_product_id = hh.m_product_id AND hh.m_product_id = 1004077
            JOIN m_attributesetinstance tt ON civ.m_attributesetinstance_id = tt.m_attributesetinstance_id
            WHERE civ.ad_client_id = $P{AD_CLIENT_ID} and (civ.ad_org_id = $P{AD_Org_ID} or $P{AD_Org_ID}  is null)
            ) AS t
        JOIN m_lot lo ON lo.name = t.lot AND (lo.M_Lot_ID = $P{M_Lot_ID} OR $P{M_Lot_ID} IS NULL) and (lo.AD_Org_ID=$P{AD_Org_ID} OR $P{AD_Org_ID} is null) 
        WHERE lo.m_lot_id IS NOT NULL AND lo.dateto >= $P{StartDate} AND lo.dateto <= $P{EndDate} 
        GROUP BY t.lot
	) as k 
) as f]]>
	</queryString>
	<field name="kq" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="kq"/>
		<property name="com.jaspersoft.studio.field.label" value="kq"/>
	</field>
	<background>
		<band splitType="Stretch"/>
	</background>
	<detail>
		<band height="23" splitType="Stretch">
			<textField pattern="#,##0.###">
				<reportElement x="0" y="0" width="50" height="23" uuid="cbe814a6-d4e7-42c7-8a87-6ea2198a1b97">
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial" size="10" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{kq}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
